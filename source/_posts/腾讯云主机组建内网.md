---
title: 腾讯云主机组建内网
categories: 运维
tags:
  - 腾讯云
  - 内网
abbrlink: 227b6bc
date: 2021-11-26 23:39:01
---

2021-11-26 周五
## 因子
因为在腾讯云买了2个云主机，通过公网IP搭建了k8s集群后，每个月网络流量就在29元。所以寻求组建内网的方法，找到后通过内网IP重新搭建了k8s，节约了成本。直接上图，见证省钱事实。

<img src="/mb/images/txy-inner/01.png">

**11月25这一天只产生了0.03的费用**

<!-- more -->

## 实现原理
***首先要知道云主机是可以设置私有网络的，然后再在2个私有网络见通过对等连接联通，从而让2个云主机处于同一个内网中。***

<img src="/mb/images/txy-inner/02.png">

借助腾讯云提供的对等连接，将2个账号的vpc(私有网络）连接到一起，组建内网。

<img src="/mb/images/txy-inner/03.png">

目前是无宽带上线，并且免费的。

## 实现步骤
1. 云主机master加入私有网络，内网IP段为`172.31.0.0/16`，并设置子网内自己的IP为`172.31.1.100`。

<img src="/mb/images/txy-inner/04.png">

2. 云主机node1加入私有网络，内网IP段为`172.30.0.0/16`，并设置子网内自己的IP为`172.30.1.100`

<img src="/mb/images/txy-inner/05.png">

3. 在master主机的私有网络里建立对等网络，选择另一个账号里的私有网络ID。

<img src="/mb/images/txy-inner/06.png">

4. 在master主机的私有网络里建立路由表，选择对等连接。

<img src="/mb/images/txy-inner/07.png">

到此一切设置完毕。
5. 验证是否连通，在master上ping node1，在node1上ping master。（通过内网）
``` bash
[root@master ~]# ping node1
PING node1 (172.30.1.100) 56(84) bytes of data.
64 bytes from node1 (172.30.1.100): icmp_seq=1 ttl=64 time=1.85 ms
64 bytes from node1 (172.30.1.100): icmp_seq=2 ttl=64 time=1.78 ms
64 bytes from node1 (172.30.1.100): icmp_seq=3 ttl=64 time=1.74 ms
```
``` bash
[root@node1 ~]# ping master
PING master (172.31.1.100) 56(84) bytes of data.
64 bytes from master (172.31.1.100): icmp_seq=1 ttl=64 time=1.78 ms
64 bytes from master (172.31.1.100): icmp_seq=2 ttl=64 time=1.76 ms
64 bytes from master (172.31.1.100): icmp_seq=3 ttl=64 time=1.76 ms
```
验证通过，恭喜你完成了腾讯云之前的内网组建，能省掉一比网络流量费了。（如果是包年流量，没这个必要。但是我个人是把流量改成20M按量收费了，这样网络会快一点。）